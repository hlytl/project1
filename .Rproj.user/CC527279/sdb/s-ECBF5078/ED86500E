{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Week3\"\nauthor: \"Ding Ding\"\ndate: \"September 22, 2016\"\noutput: html_document\n---\n\n```{r setup, include=FALSE,eval=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\nlist.dirs()\ndatadir <- \"./data/FARS2015NationalCSV \"\nACC_AUX <- read.csv(file=paste0(datadir,\"/ACC_AUX.CSV\"))\nsummary(ACC_AUX)\nPER_AUX <- read.csv(file=paste0(datadir,\"/PER_AUX.CSV\"))\ncolnames(PER_AUX)\nVEH_AUX <- read.csv(file=paste0(datadir,\"/VEH_AUX.CSV\"))\n colnames(VEH_AUX) \n accident <- read.csv(file=paste0(datadir,\"/accident.csv\"))\n library(data.table)\ntempdata <- fread(\"./data/acc_aux.sas7bdat\")\ninstall.packages(\"sas7bdat\")\nlibrary(sas7bdat)\ninstall.packages(\"downloader\")\nlibrary(downloader)\ntempdata <- read.sas7bdat(\"./data/acc_aux.sas7bdat\")\nurl <- paste0(\"ftp://ftp.nhtsa.dot.gov/fars/\",seq(1982,2012),\"/Auxiliary_FARS_Files/Auxiliary_FARS_SAS_\",seq(1982,2012),\".zip\")\nsetwd(\"~/Downloads/FARS\")\nfor(i in 1:length(url)){\n  download(url[i],\n    destfile=paste0(\"~/Downloads/FARS/\",(i+1981),\".zip\"))\n}\nfor(i in 1982:2014){\n  dir.create(paste0(\"~/Downloads/FARS/\",i))\n}\nfor(i in 1:(length(url)+1)){\nunzip(paste0((i+1981),\".zip\"),files=paste0(\"~/Downloads/FARS/\",(i+1981)))\n}\ntempname <- seq(1982,2010)\ntempname <- as.character(tempname)\nfor(i in 1982:2010){\nunzip(paste0(i,\".zip\"))\nfile.rename(\"FARS\",tempname[i-1981])\n}\n\ntempdata <- read.sas7bdat(paste0(\"~/Downloads/FARS\",\"/2000/\",\"acc_aux.sas7bdat\"))\ntempdata1 <- read.sas7bdat(paste0(getwd(),\"/1985/\",\"acc_aux.sd2\"))\ninstall.packages(\"Hmisc\")\nlibrary(Hmisc)\ntempdata1 <- sas.get(paste0(getwd(),\"/1985/\"), \"datafile\")\n\n####since 1999 the sas file is in .sas7bdat\nlibrary(lubridate)\ndata_download_data <- now()\nacc_aux <- list()\nper_aux <- list()\nveh_aux <- list()\nfor(i in 1999:2014){\n  acc_aux[[i-1998]] <- read.sas7bdat(paste0(\"~/Downloads/FARS/\",i,\"/acc_aux.sas7bdat\"))\n  per_aux[[i-1998]] <- read.sas7bdat(paste0(\"~/Downloads/FARS/\",i,\"/per_aux.sas7bdat\"))\n  veh_aux[[i-1998]] <- read.sas7bdat(paste0(\"~/Downloads/FARS/\",i,\"/veh_aux.sas7bdat\"))\n\n}\n  acc_aux[[i-1998]] <- read.sas7bdat(\"acc_aux.sas7bdat\")\n  per_aux[[i-1998]] <- read.sas7bdat(\"per_aux.sas7bdat\")\n  veh_aux[[i-1998]] <- read.sas7bdat(\"veh_aux.sas7bdat\")\n      acc_aux[[16]] <- read.sas7bdat(\"acc_aux.sas7bdat\")\n  per_aux[[16]] <- read.sas7bdat(\"per_aux.sas7bdat\")\n  veh_aux[[16]] <- read.sas7bdat(\"veh_aux.sas7bdat\")\n    acc_aux[[17]] <- ACC_AUX\n  per_aux[[17]] <- PER_AUX\n  veh_aux[[17]] <- VEH_AUX\nsave(acc_aux, per_aux, veh_aux,file=\"0922.RData\")\ncheck <- lapply(acc_aux,colnames)\nyear_x <- sapply(acc_aux,function(x) unique(x$YEAR))\ncase_y <- sapply(acc_aux,function(x) length(unique(x$ST_CASE)))\nplot(as.factor(year_x),case_y,ylim = c(0,50000),xlab=\"year\",ylab=\"total_case\")\nstate_y <- lapply(acc_aux,function(x) table(x$STATE))\nlengths(state_y)\nfor(i in 2:length(state_y)){\ntemp<- identical(names(state_y[[1]]),names(state_y[[i]]))\nprint(temp)\n}\nstate_y <- as.data.frame(state_y)\ndim(state_y)\nstate_y1 <- state_y[,seq(2,34,by=2)]\nplot(as.factor(state_y[,31]),state_y[,32],xaxt=\"n\",xlab=\"state\",ylab=\"total_case_2015\")\naxis(1,at=1:51,labels=as.factor(state_y[,31]),cex.axis=0.6,tick = 0.2)\nfor(i in 1:nrow(state_y1)){\n  plot((year_x),state_y1[i,],type=\"o\",xlab=paste0(\"state\",state_y[i,1]),ylab=\"case_by_state\")\n}\n```\n\n```{r plot}\nplot(as.factor(state_y[,31]),state_y[,32],xaxt=\"n\",xlab=\"state\",ylab=\"total_case_2015\")\naxis(1,at=1:51,labels=as.factor(state_y[,31]),cex.axis=0.6,tick = 0.2)\nfor(i in 1:nrow(state_y1)){\n  plot((year_x),state_y1[i,],type=\"o\",xlab=paste0(\"state\",state_y[i,1]),ylab=\"case_by_state\")\n}\n```\n",
    "created" : 1474570024320.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3909985297",
    "id" : "ED86500E",
    "lastKnownWriteTime" : 1474638012,
    "last_content_update" : 1474638012640,
    "path" : "~/Desktop/project1/week3.Rmd",
    "project_path" : "week3.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}